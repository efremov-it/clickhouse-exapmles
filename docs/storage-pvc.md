Для реализации отказоустойчивого ClickHouse кластера с несколькими нодами и репликами, каждая нода должна иметь своё хранилище. Настройка PVC (PersistentVolumeClaim) для хранения данных ClickHouse зависит от числа нод и реплик, а также от способа репликации и шардирования данных. Вот рекомендации по необходимому количеству и типу PVC для конфигураций, описанных выше.

### 1. Конфигурация на 2 ноды и 2 шарда

В этом варианте:
- 2 ноды с одной репликой каждого шарда на каждой ноде.
  
**Требования к PVC:**
- Понадобится **2 PVC** для каждой ноды (по одной для каждой реплики).
- Каждая PVC должна быть типа `ReadWriteOnce` (RWO), так как реплики одного шарда не будут совместно использовать один PVC (данные одного шарда будут на одной ноде, реплика на другой).

**Рекомендуемое количество и типы PVC:**
- Нода 1:
  - `shard0.replica0`: PVC типа `ReadWriteOnce`
  - `shard1.replica0`: PVC типа `ReadWriteOnce`
- Нода 2:
  - `shard0.replica1`: PVC типа `ReadWriteOnce`
  - `shard1.replica1`: PVC типа `ReadWriteOnce`

Итого: **4 PVC типа RWO** по одному для каждой реплики.

### 2. Конфигурация на 3 ноды и 3 шарда

Для 3 нод с тремя шардированными репликами на каждой ноде:
- В этом случае каждая нода будет иметь одну реплику каждого шарда.

**Требования к PVC:**
- Понадобится **3 PVC на каждую ноду** — по одной для каждой реплики, то есть **всего 9 PVC**.
- PVC также будут типа `ReadWriteOnce`, чтобы избежать одновременного доступа к одной и той же реплике с других нод.

**Рекомендуемое количество и типы PVC:**
- Нода 1:
  - `shard0.replica0`: PVC типа `ReadWriteOnce`
  - `shard1.replica0`: PVC типа `ReadWriteOnce`
  - `shard2.replica0`: PVC типа `ReadWriteOnce`
- Нода 2:
  - `shard0.replica1`: PVC типа `ReadWriteOnce`
  - `shard1.replica1`: PVC типа `ReadWriteOnce`
  - `shard2.replica1`: PVC типа `ReadWriteOnce`
- Нода 3:
  - `shard0.replica2`: PVC типа `ReadWriteOnce`
  - `shard1.replica2`: PVC типа `ReadWriteOnce`
  - `shard2.replica2`: PVC типа `ReadWriteOnce`

Итого: **9 PVC типа RWO** по одному для каждой реплики.

### Общие рекомендации:

- **Размер PVC**: Рекомендуется рассчитывать размер PVC на основе предполагаемого объема данных для каждой реплики. Обычно это определяется объемом данных, требуемым для хранения каждой реплики плюс место для роста.
- **Тип хранения**: Используйте надёжное хранилище с хорошей производительностью, особенно при высоких нагрузках на запись и чтение.
- **StorageClass**: Настройка `StorageClass` для PVC должна учитывать требования по скорости чтения/записи, например, `fast` или `ssd`, если доступно.

Эти рекомендации обеспечат необходимую отказоустойчивость и производительность для хранения данных ClickHouse в конфигурациях с несколькими нодами и репликами.
